<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì‹ìƒí™œ ê· í˜• ì‹ë‹¨ ì‹œë®¬ë ˆì´í„°</title>
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(180deg, #fdf6e3, #f6f9ff);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }
    .app {
      max-width: 960px;
      width: 100%;
      margin: 24px;
      background: #ffffffcc;
      border-radius: 16px;
      padding: 24px 20px 28px;
      box-shadow: 0 10px 28px rgba(0,0,0,0.06);
    }
    h1, h2, h3 {
      margin-top: 0;
    }
    h1 {
      font-size: 24px;
      text-align: center;
      margin-bottom: 12px;
    }
    .subtitle {
      text-align: center;
      font-size: 14px;
      color: #555;
      margin-bottom: 20px;
    }

    .screen {
      display: none;
    }
    .screen.active {
      display: block;
    }

    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
      margin-top: 12px;
    }
    .menu-card {
      background: #fff;
      border-radius: 12px;
      padding: 14px 14px 16px;
      border: 1px solid #e3e3e3;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
    }
    .menu-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 18px rgba(0,0,0,0.05);
      border-color: #92c5ff;
    }
    .menu-card.selected {
      border-color: #4b8cf5;
      box-shadow: 0 8px 22px rgba(75,140,245,0.25);
    }
    .menu-title {
      font-weight: 700;
      font-size: 16px;
      margin-bottom: 4px;
    }
    .menu-emoji {
      font-size: 26px;
      margin-right: 6px;
    }
    .menu-desc {
      font-size: 13px;
      color: #555;
      margin-bottom: 6px;
    }
    .menu-meta {
      font-size: 12px;
      color: #777;
    }

    .btn-row {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 16px;
      flex-wrap: wrap;
    }
    button {
      border-radius: 999px;
      padding: 8px 16px;
      border: none;
      font-size: 14px;
      cursor: pointer;
      background: #4b8cf5;
      color: white;
      box-shadow: 0 4px 10px rgba(75,140,245,0.35);
      transition: background 0.15s ease, transform 0.1s ease, box-shadow 0.1s ease;
    }
    button:hover {
      background: #3a78dd;
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(75,140,245,0.4);
    }
    button.secondary {
      background: #e5ebf5;
      color: #333;
      box-shadow: none;
    }
    button.secondary:hover {
      background: #d4deee;
      box-shadow: none;
    }
    button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      box-shadow: none;
    }

    .story-page {
      min-height: 160px;
      background: #fff;
      border-radius: 12px;
      padding: 16px 14px;
      border: 1px dashed #e0cfa6;
      position: relative;
      overflow: hidden;
    }
    .story-badge {
      position: absolute;
      top: 10px;
      right: 12px;
      font-size: 11px;
      color: #777;
      background: #fdf0d0;
      padding: 3px 8px;
      border-radius: 999px;
    }
    .story-text {
      font-size: 14px;
      line-height: 1.6;
      white-space: pre-line;
    }
    .story-page-index {
      margin-top: 8px;
      font-size: 12px;
      text-align: right;
      color: #666;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      border-radius: 999px;
      background: #f0f4ff;
      font-size: 12px;
      color: #395794;
      margin-right: 4px;
      margin-bottom: 4px;
    }

    .builder-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 14px;
      margin-top: 12px;
    }
    .ingredient-group {
      background: #fff;
      border-radius: 12px;
      padding: 10px 10px 12px;
      border: 1px solid #e4e4e4;
    }
    .group-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .group-subtitle {
      font-size: 11px;
      color: #777;
      margin-bottom: 6px;
    }
    .ingredient-option {
      display: flex;
      align-items: flex-start;
      gap: 6px;
      font-size: 13px;
      padding: 4px 0;
    }
    .ingredient-option input {
      margin-top: 3px;
    }
    .ingredient-main {
      font-weight: 500;
    }
    .ingredient-meta {
      font-size: 11px;
      color: #666;
    }

    .summary-box {
      background: #fff;
      border-radius: 12px;
      padding: 14px 14px 12px;
      border: 1px solid #e4e4e4;
      margin-top: 10px;
      font-size: 13px;
    }
    .summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
    }
    .summary-label {
      color: #666;
    }
    .summary-value {
      font-weight: 600;
    }

    .result-main-score {
      font-size: 20px;
      font-weight: 700;
      text-align: center;
      margin-bottom: 6px;
    }
    .result-badge {
      text-align: center;
      font-size: 13px;
      margin-bottom: 12px;
      color: #555;
    }
    .feedback-box {
      background: #fff;
      border-radius: 12px;
      padding: 12px 12px 14px;
      border-left: 5px solid #4b8cf5;
      font-size: 13px;
      line-height: 1.6;
      white-space: pre-line;
    }
    .result-list {
      margin-top: 10px;
      font-size: 13px;
    }
    .result-list ul {
      padding-left: 18px;
      margin: 4px 0 0;
    }

    @media (max-width: 600px) {
      .app {
        margin: 12px;
        padding: 18px 14px 20px;
      }
      h1 {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
<div class="app">
  <h1>ì‹ìƒí™œ ê· í˜• ì‹ë‹¨ ì‹œë®¬ë ˆì´í„°</h1>
  <div class="subtitle">
    5í•™ë…„ ì‹ìƒí™œ ë‹¨ì› &lt;ê· í˜• ì¡íŒ ì‹ë‹¨ ë§Œë“¤ê¸°&gt; ìˆ˜í–‰ í‰ê°€ìš© ì‹œë®¬ë ˆì´í„°
  </div>

  <!-- 1. ë©”ë‰´ ì„ íƒ í™”ë©´ -->
  <div id="screen-menu" class="screen active">
    <h2>1ë‹¨ê³„. ì–´ë–¤ ë¼ë‹ˆë¥¼ ë§Œë“¤ê¹Œìš”?</h2>
    <p style="font-size:13px;color:#555;margin-top:4px;">
      ë§Œë“¤ê³  ì‹¶ì€ ë©”ë‰´ë¥¼ ê³ ë¥¸ ë’¤, <b>ì´ì•¼ê¸° ì†ìœ¼ë¡œ</b> ë“¤ì–´ê°€ ë³´ì„¸ìš”.
    </p>
    <div id="menuGrid" class="menu-grid">
      <!-- JSë¡œ ì±„ì›€ -->
    </div>
    <div class="btn-row">
      <button id="btnMenuNext" disabled>ì´ ë©”ë‰´ë¡œ ì´ì•¼ê¸° ì‹œì‘í•˜ê¸° â–¶</button>
    </div>
  </div>

  <!-- 2. ìŠ¤í† ë¦¬ í™”ë©´ -->
  <div id="screen-story" class="screen">
    <h2>2ë‹¨ê³„. ì‘ì€ ë™í™” ì†ìœ¼ë¡œ ë“¤ì–´ê°€ìš”</h2>
    <div id="storyContainer" class="story-page">
      <div class="story-badge" id="storyMenuBadge"></div>
      <div id="storyText" class="story-text"></div>
      <div id="storyPageIndex" class="story-page-index"></div>
    </div>
    <div class="btn-row">
      <button class="secondary" id="btnStoryBack">â—€ ë©”ë‰´ ë‹¤ì‹œ ê³ ë¥´ê¸°</button>
      <button id="btnStoryNext">ë‹¤ìŒ ì¥ ë„˜ê¸°ê¸° â–¶</button>
    </div>
  </div>

  <!-- 3. ì¬ë£Œ ì„ íƒ í™”ë©´ -->
  <div id="screen-builder" class="screen">
    <h2>3ë‹¨ê³„. ì¬ë£Œë¥¼ ê³¨ë¼ì„œ ë‚˜ë§Œì˜ ì‹ë‹¨ ë§Œë“¤ê¸°</h2>
    <div id="builderSubTitle" style="font-size:13px;color:#555;margin-bottom:6px;"></div>
    <div class="pill" id="pillBudget"></div>
    <div class="pill" id="pillCalorie"></div>
    <div class="pill" id="pillGoal"></div>

    <div id="builderGrid" class="builder-grid">
      <!-- JSë¡œ ì¹´í…Œê³ ë¦¬ & ì¬ë£Œ ë Œë”ë§ -->
    </div>

    <div class="summary-box" id="selectionSummary">
      <div class="summary-row">
        <div class="summary-label">ì„ íƒí•œ ì¬ë£Œ ìˆ˜</div>
        <div class="summary-value" id="sumCount">0ê°œ</div>
      </div>
      <div class="summary-row">
        <div class="summary-label">ì˜ˆìƒ ì¹¼ë¡œë¦¬</div>
        <div class="summary-value" id="sumCalorie">0 kcal</div>
      </div>
      <div class="summary-row">
        <div class="summary-label">ì˜ˆìƒ ê°€ê²©</div>
        <div class="summary-value" id="sumPrice">0ì›</div>
      </div>
      <div class="summary-row">
        <div class="summary-label">í¬í•¨ëœ ì˜ì–‘ì†Œ ì¢…ë¥˜</div>
        <div class="summary-value" id="sumNutrients">-</div>
      </div>
    </div>

    <div class="btn-row">
      <button class="secondary" id="btnBuilderBack">â—€ ì´ì•¼ê¸° ë‹¤ì‹œ ë³´ê¸°</button>
      <button id="btnEvaluate">ì ìˆ˜ & í”¼ë“œë°± ë³´ê¸° â–¶</button>
    </div>
  </div>

  <!-- 4. ê²°ê³¼ í™”ë©´ -->
  <div id="screen-result" class="screen">
    <h2>4ë‹¨ê³„. ì ìˆ˜ì™€ í”¼ë“œë°±</h2>
    <div class="result-main-score">
      ì´ì  <span id="resultScore">0</span>ì  / 100ì 
    </div>
    <div class="result-badge" id="resultBadge"></div>
    <div class="feedback-box" id="feedbackText"></div>

    <div class="result-list">
      <strong>ğŸ“Œ ë‚´ ì‹ë‹¨ ìš”ì•½</strong>
      <ul id="resultSummaryList">
        <!-- JSë¡œ ì±„ì›€ -->
      </ul>
    </div>

    <div class="btn-row">
      <button class="secondary" id="btnResultBack">â—€ ì¬ë£Œ ë‹¤ì‹œ ê³ ë¥´ê¸°</button>
      <button id="btnRestart">ì²˜ìŒë¶€í„° ë‹¤ì‹œ í•˜ê¸° ğŸ”</button>
    </div>
  </div>
</div>

<script>
  // --------- ë°ì´í„° ì •ì˜ ---------

  const MENUS = {
    sandwich: {
      key: "sandwich",
      emoji: "ğŸ¥ª",
      name: "ì•„ì¹¨ ìƒŒë“œìœ„ì¹˜ ì„¸íŠ¸",
      desc: "ì•„ì¹¨ ë“±êµ ì „ì— í›„ë‹¤ë‹¥ ë§Œë“œëŠ” ê±´ê°•í•œ ìƒŒë“œìœ„ì¹˜",
      budget: 5000,
      calorieMin: 350,
      calorieMax: 500,
      goal: "íƒ„ìˆ˜í™”ë¬¼ + ë‹¨ë°±ì§ˆ + ì±„ì†Œê°€ ëª¨ë‘ ë“¤ì–´ê°€ë©´ ì¢‹ì•„ìš”!"
    },
    lunchbox: {
      key: "lunchbox",
      emoji: "ğŸ±",
      name: "ì ì‹¬ ë„ì‹œë½",
      desc: "í•™êµì—ì„œ ë¨¹ì„ ì•Œë¡ë‹¬ë¡ ì˜ì–‘ ë§Œì  ë„ì‹œë½",
      budget: 7000,
      calorieMin: 500,
      calorieMax: 750,
      goal: "ì£¼ì‹ + ë‹¨ë°±ì§ˆ ë°˜ì°¬ + ì±„ì†Œ ë°˜ì°¬ + ê³¼ì¼ì´ë©´ ì™„ë²½í•´ìš”!"
    },
    salad: {
      key: "salad",
      emoji: "ğŸ¥—",
      name: "ê°„ì‹ ìƒëŸ¬ë“œ ë³¼",
      desc: "ê³µë¶€í•˜ë‹¤ê°€ ë¨¹ëŠ” ê°€ë²¼ìš´ ìƒëŸ¬ë“œ ê°„ì‹",
      budget: 4000,
      calorieMin: 200,
      calorieMax: 400,
      goal: "ì±„ì†Œì™€ ê³¼ì¼ì´ í’ë¶€í•˜ê³ , ë‹¨ë°±ì§ˆì´ ì¡°ê¸ˆ ë“¤ì–´ê°€ë©´ ì¢‹ì•„ìš”!"
    }
  };

  // ë©”ë‰´ë³„ ìŠ¤í† ë¦¬ (ë™í™” ëŠë‚Œ)
  const STORY_PAGES = {
    sandwich: [
      "ì•„ì¹¨ í–‡ì‚´ì´ ì‚´ì§ ë¹„ì¹˜ëŠ” ì°½ê°€.\nì•ŒëŒ ì†Œë¦¬ì— ëˆˆì„ ëœ¬ ë„ˆëŠ” ì ê¹ ë©í•˜ë‹ˆ ì°½ë°–ì„ ë°”ë¼ë´¤ì–´ìš”.\nì˜¤ëŠ˜ì€ í•™êµì—ì„œ 'ê±´ê°•í•œ ì•„ì¹¨ ì±Œë¦°ì§€' ë‚ !\nì§ì ‘ ë§Œë“  ìƒŒë“œìœ„ì¹˜ë¥¼ ê°€ì ¸ì™€ì•¼ í•˜ëŠ” íŠ¹ë³„í•œ ë‚ ì´ì—ìš”.",
      "ëƒ‰ì¥ê³ ë¥¼ ì—´ì–´ë³´ë‹ˆ ì—¬ëŸ¬ ê°€ì§€ ì¬ë£Œë“¤ì´ ë„ˆë¥¼ ê¸°ë‹¤ë¦¬ê³  ìˆì—ˆì–´ìš”.\nâ€œë‚˜ë¥¼ ì¨ì¤˜! ë‚˜ë¥¼ ì¨ì¤˜!â€\nì‹ë¹µ, ê³„ë€, ì–‘ìƒì¶”, í† ë§ˆí† , ì¹˜ì¦ˆê°€ ì„œë¡œ ë¨¼ì € ë“¤ì–´ê°€ê³  ì‹¶ì–´ í•˜ë„¤ìš”.\ní•˜ì§€ë§Œ ì•„ë¬´ ì¬ë£Œë‚˜ ë§‰ ë„£ìœ¼ë©´ ì˜ì–‘ì´ ì—‰ë§ì´ ë ì§€ë„ ëª°ë¼ìš”.",
      "ì˜¤ëŠ˜ í•˜ë£¨ ì§‘ì¤‘í•´ì„œ ìˆ˜ì—…ì„ ë“£ê³  ì‹¶ë‹¤ë©´,\níƒ„ìˆ˜í™”ë¬¼, ë‹¨ë°±ì§ˆ, ì±„ì†Œê°€ ê³¨ê³ ë£¨ ë“¤ì–´ê°„ ìƒŒë“œìœ„ì¹˜ë¥¼ ë§Œë“¤ì–´ì•¼ í•´ìš”.\nì´ì œ ì–´ë–¤ ì¬ë£Œë“¤ì„ ì„ íƒí• ì§€ ì‹ ì¤‘í•˜ê²Œ ê³¨ë¼ë³¼ê¹Œìš”?"
    ],
    lunchbox: [
      "ë‚´ì¼ì€ ê¸°ë‹¤ë¦¬ê³  ê¸°ë‹¤ë¦¬ë˜ 'í”¼í¬ë‹‰ ë‚ 'ì´ì—ìš”.\nì„ ìƒë‹˜ì€ ë„ì‹œë½ì„ ì§ì ‘ ì‹¸ ì˜¤ëŠ” ë‚ ì´ë¼ê³  ì•Œë ¤ì£¼ì…¨ì–´ìš”.\nâ€œê·¸ëƒ¥ ì•„ë¬´ê±°ë‚˜ ì‹¸ ì˜¤ë©´ ë˜ê² ì§€?â€\nì²˜ìŒì—” ê·¸ë ‡ê²Œ ìƒê°í–ˆì§€ë§Œ, ë¬¸ë“ ë– ì˜¤ë¥¸ ë§ì´ ìˆì–´ìš”.",
      "â€œê· í˜• ì¡íŒ ì‹ë‹¨ì´ ê±´ê°•í•œ ëª¸ì„ ë§Œë“ ë‹¤.â€\nì‹¤ê³¼ ì‹œê°„ì— ë°°ìš´ ë§ì´ ë– ì˜¤ë¥´ì,\në„ˆëŠ” ì´ë²ˆì—ëŠ” ì§„ì§œë¡œ ì˜ì–‘ê¹Œì§€ ìƒê°í•´ì„œ ë„ì‹œë½ì„ ì‹¸ë³´ê¸°ë¡œ í–ˆì–´ìš”.\në°¥, ë‹¨ë°±ì§ˆ ë°˜ì°¬, ì±„ì†Œ ë°˜ì°¬, ê³¼ì¼ê¹Œì§€ ê³ ë£¨ ë“¤ì–´ê°€ë©´ ì¢‹ê² ì£ ?",
      "ëƒ‰ì¥ê³ ì™€ ì°¬ì¥ì„ ì‚´í´ë³´ë‹ˆ ì¬ë£Œë“¤ì´ ê½¤ ë§ì•„ìš”.\ní•˜ì§€ë§Œ ì˜ˆì‚°ë„ ìˆê³ , ë„ˆë¬´ ê¸°ë¦„ì§€ì§€ë§Œ ì•Šê²Œ ë§Œë“œëŠ” ê²ƒë„ ì¤‘ìš”í•´ìš”.\nì´ì œ ë„ˆë§Œì˜ 'í”¼í¬ë‹‰ ë„ì‹œë½'ì„ ì™„ì„±í•´ ë³¼ê¹Œìš”?"
    ],
    salad: [
      "ìš”ì¦˜ ë“¤ì–´ ì˜¤í›„ë§Œ ë˜ë©´ ëˆˆì´ ìŠ¤ë¥´ë¥´ ê°ê¸°ê³ ,\nì§‘ì— ëŒì•„ì˜¤ë©´ ê¸ˆì„¸ ì§€ì³ë²„ë¦¬ê³¤ í•´ìš”.\nâ€œí˜¹ì‹œ ë‚´ê°€ ê°„ì‹ì„ ë„ˆë¬´ ê³¼ìë¡œë§Œ ë¨¹ì–´ì„œ ê·¸ëŸ°ê°€?â€\në„ˆëŠ” ìŠ¤ìŠ¤ë¡œì—ê²Œ ì´ë ‡ê²Œ ë¬¼ì–´ë´¤ì–´ìš”.",
      "ì‹¤ê³¼ ì‹œê°„ì— ë°°ìš´ 'ê±´ê°•í•œ ê°„ì‹' ì´ì•¼ê¸°ê°€ ë– ì˜¤ë¥´ë„¤ìš”.\nê³¼ì ëŒ€ì‹  ì±„ì†Œì™€ ê³¼ì¼, ê·¸ë¦¬ê³  ì¡°ê¸ˆì˜ ë‹¨ë°±ì§ˆì´ ë“¤ì–´ê°„ ê°€ë²¼ìš´ ê°„ì‹ì„ ë¨¹ìœ¼ë©´\nëª¸ë„ ë§ˆìŒë„ í•œê²° ê°€ë²¼ì›Œì§ˆ ìˆ˜ ìˆë‹¤ê³  í–ˆì£ .",
      "ê·¸ë˜ì„œ ì˜¤ëŠ˜ì€ 'ê±´ê°•í•œ ìƒëŸ¬ë“œ ë³¼'ì„ ë§Œë“¤ì–´ ë³´ê¸°ë¡œ í–ˆì–´ìš”.\nì–´ë–¤ ì±„ì†Œì™€ ê³¼ì¼ì„ ë„£ê³ ,\nì–´ë–¤ ë‹¨ë°±ì§ˆì„ ì‚´ì§ ê³ë“¤ì´ë©´ ì¢‹ì„ê¹Œìš”?\nì´ì œ ì¬ë£Œë¥¼ ê³¨ë¼ì„œ ë‚˜ë§Œì˜ ìƒëŸ¬ë“œ ë³¼ì„ ì™„ì„±í•´ìš”!"
    ]
  };

  // ì¬ë£Œ ì •ì˜
  // nutrients: ëŒ€ëµì ì¸ ê·¸ë£¹ ì´ë¦„ë“¤ (íƒ„ìˆ˜í™”ë¬¼, ë‹¨ë°±ì§ˆ, ì±„ì†Œ, ê³¼ì¼, ì§€ë°©, ì¹¼ìŠ˜, ì‹ì´ì„¬ìœ  ë“±)
  const INGREDIENTS = {
    sandwich: {
      groups: [
        {
          key: "main",
          title: "ë¹µ(ì£¼ì‹)",
          subtitle: "ìƒŒë“œìœ„ì¹˜ì˜ ê¸°ë³¸ì´ ë˜ëŠ” ë¹µì„ ê³¨ë¼ìš”.",
          options: [
            {
              id: "white_bread",
              name: "ì‹ë¹µ 2ì¥",
              calories: 160,
              price: 700,
              nutrients: ["íƒ„ìˆ˜í™”ë¬¼"],
              note: "ë¶€ë“œëŸ½ì§€ë§Œ ì‹ì´ì„¬ìœ ëŠ” ì ì–´ìš”."
            },
            {
              id: "whole_bread",
              name: "í†µë°€ë¹µ 2ì¥",
              calories: 170,
              price: 1000,
              nutrients: ["íƒ„ìˆ˜í™”ë¬¼", "ì‹ì´ì„¬ìœ "],
              note: "ì‹ì´ì„¬ìœ ê°€ í’ë¶€í•´ìš”."
            },
            {
              id: "tortilla",
              name: "ë˜ë ì•„ 1ì¥",
              calories: 150,
              price: 900,
              nutrients: ["íƒ„ìˆ˜í™”ë¬¼"],
              note: "ëŒëŒ ë§ê¸° ì¢‹ì€ ë¹µì´ì—ìš”."
            }
          ]
        },
        {
          key: "protein",
          title: "ë‹¨ë°±ì§ˆ ì¬ë£Œ",
          subtitle: "í¬ë§Œê°ì„ ì£¼ëŠ” ë‹¨ë°±ì§ˆì„ ì„ íƒí•´ìš”.",
          options: [
            {
              id: "egg",
              name: "ê³„ë€ í”„ë¼ì´",
              calories: 90,
              price: 800,
              nutrients: ["ë‹¨ë°±ì§ˆ"],
              note: "ë‹¨ë°±ì§ˆì´ í’ë¶€í•œ ê¸°ë³¸ ì¬ë£Œ."
            },
            {
              id: "chicken_slice",
              name: "ìŠ¬ë¼ì´ìŠ¤ ì¹˜í‚¨",
              calories: 100,
              price: 1500,
              nutrients: ["ë‹¨ë°±ì§ˆ"],
              note: "ì‚´ì½”ê¸°ë¼ ë¹„êµì  ì§€ë°©ì´ ì ì–´ìš”."
            },
            {
              id: "ham",
              name: "í–„",
              calories: 110,
              price: 1200,
              nutrients: ["ë‹¨ë°±ì§ˆ"],
              note: "ê°€ê³µì‹í’ˆì´ë¼ ë‚˜íŠ¸ë¥¨ì´ ë§ì•„ìš”."
            }
          ]
        },
        {
          key: "veggie",
          title: "ì±„ì†ŒÂ·ê³¼ì¼",
          subtitle: "ë¹„íƒ€ë¯¼ê³¼ ë¬´ê¸°ì§ˆì„ ì±…ì„ì§€ëŠ” ì¹œêµ¬ë“¤!",
          options: [
            {
              id: "lettuce",
              name: "ì–‘ìƒì¶” í•œ ì¤Œ",
              calories: 10,
              price: 500,
              nutrients: ["ì±„ì†Œ", "ì‹ì´ì„¬ìœ "],
              note: "ì•„ì‚­ì•„ì‚­ ì‹ê°ì„ ë”í•´ì¤˜ìš”."
            },
            {
              id: "tomato",
              name: "í† ë§ˆí†  ìŠ¬ë¼ì´ìŠ¤",
              calories: 15,
              price: 700,
              nutrients: ["ì±„ì†Œ", "ë¹„íƒ€ë¯¼"],
              note: "ìƒ‰ê¹”ê³¼ ìƒí¼í•¨ì„ ë”í•´ì¤˜ìš”."
            },
            {
              id: "apple_slice",
              name: "ì‚¬ê³¼ ìŠ¬ë¼ì´ìŠ¤",
              calories: 30,
              price: 800,
              nutrients: ["ê³¼ì¼", "ë¹„íƒ€ë¯¼"],
              note: "ìƒŒë“œìœ„ì¹˜ì— ë‹¬ì½¤í•¨ì„ ë”í•´ì¤˜ìš”."
            }
          ]
        },
        {
          key: "extra",
          title: "ê¸°íƒ€ ì¬ë£Œ",
          subtitle: "ë§›ì„ ë”í•´ì£¼ëŠ” ì¬ë£Œì§€ë§Œ ë„ˆë¬´ ë§ì´ ë„£ì§€ ì•Šë„ë¡!",
          options: [
            {
              id: "cheese",
              name: "ìŠ¬ë¼ì´ìŠ¤ ì¹˜ì¦ˆ",
              calories: 70,
              price: 700,
              nutrients: ["ì§€ë°©", "ì¹¼ìŠ˜"],
              note: "ì¹¼ìŠ˜ì´ ìˆì§€ë§Œ ì§€ë°©ë„ ìˆì–´ìš”."
            },
            {
              id: "mayo",
              name: "ë§ˆìš”ë„¤ì¦ˆ í•œ ìŠ¤í‘¼",
              calories: 90,
              price: 300,
              nutrients: ["ì§€ë°©"],
              note: "ë§›ì€ ì¢‹ì§€ë§Œ ì§€ë°©ì´ ë§ì•„ìš”."
            },
            {
              id: "olive_oil",
              name: "ì˜¬ë¦¬ë¸Œìœ  ì‚´ì§",
              calories: 60,
              price: 500,
              nutrients: ["ì§€ë°©"],
              note: "ì‹ë¬¼ì„± ì§€ë°©ìœ¼ë¡œ ì¡°ê¸ˆì€ ê´œì°®ì•„ìš”."
            }
          ]
        }
      ]
    },
    lunchbox: {
      groups: [
        {
          key: "staple",
          title: "ì£¼ì‹(ë°¥/ë©´)",
          subtitle: "ë„ì‹œë½ì˜ ì¤‘ì‹¬ì´ ë˜ëŠ” ì£¼ì‹ì„ ê³¨ë¼ìš”.",
          options: [
            {
              id: "white_rice",
              name: "í°ìŒ€ë°¥ 1ê³µê¸°",
              calories: 300,
              price: 1000,
              nutrients: ["íƒ„ìˆ˜í™”ë¬¼"],
              note: "ê°€ì¥ ê¸°ë³¸ì ì¸ ë°¥ì´ì—ìš”."
            },
            {
              id: "mixed_rice",
              name: "ì¡ê³¡ë°¥ 1ê³µê¸°",
              calories: 310,
              price: 1300,
              nutrients: ["íƒ„ìˆ˜í™”ë¬¼", "ì‹ì´ì„¬ìœ "],
              note: "ì‹ì´ì„¬ìœ ì™€ ë¬´ê¸°ì§ˆì´ ë” ë“¤ì–´ ìˆì–´ìš”."
            },
            {
              id: "noodle",
              name: "ë¹„ë¹”êµ­ìˆ˜ 1ì¸ë¶„",
              calories: 350,
              price: 1500,
              nutrients: ["íƒ„ìˆ˜í™”ë¬¼"],
              note: "êµ­ìˆ˜ì§€ë§Œ ì±„ì†Œì™€ í•¨ê»˜ ë¨¹ìœ¼ë©´ ì¢‹ì•„ìš”."
            }
          ]
        },
        {
          key: "main_side",
          title: "ë‹¨ë°±ì§ˆ ë°˜ì°¬",
          subtitle: "í˜ì„ ë‚´ê²Œ í•´ ì£¼ëŠ” ë‹¨ë°±ì§ˆ ë°˜ì°¬ì´ì—ìš”.",
          options: [
            {
              id: "bulgogi",
              name: "ì†Œë¶ˆê³ ê¸°",
              calories: 220,
              price: 2500,
              nutrients: ["ë‹¨ë°±ì§ˆ"],
              note: "ë§›ìˆì§€ë§Œ ì–‘ë…ê³¼ ê¸°ë¦„ì´ ì¡°ê¸ˆ ë§ì•„ìš”."
            },
            {
              id: "chicken_breast",
              name: "ë‹­ê°€ìŠ´ì‚´ êµ¬ì´",
              calories: 160,
              price: 2200,
              nutrients: ["ë‹¨ë°±ì§ˆ"],
              note: "ë‹¨ë°±ì§ˆì´ ë§ê³  ë¹„êµì  ì§€ë°©ì´ ì ì–´ìš”."
            },
            {
              id: "fried_shrimp",
              name: "ìƒˆìš°íŠ€ê¹€",
              calories: 200,
              price: 2300,
              nutrients: ["ë‹¨ë°±ì§ˆ", "ì§€ë°©"],
              note: "ê¸°ë¦„ì— íŠ€ê²¨ì ¸ ì§€ë°©ì´ ë§ì•„ìš”."
            }
          ]
        },
        {
          key: "veggie_side",
          title: "ì±„ì†Œ ë°˜ì°¬",
          subtitle: "ë¹„íƒ€ë¯¼ê³¼ ì‹ì´ì„¬ìœ ë¥¼ ì±„ì›Œì¤˜ìš”.",
          options: [
            {
              id: "spinach",
              name: "ì‹œê¸ˆì¹˜ë‚˜ë¬¼",
              calories: 30,
              price: 700,
              nutrients: ["ì±„ì†Œ", "ì‹ì´ì„¬ìœ "],
              note: "ì² ë¶„ê³¼ ë¹„íƒ€ë¯¼ì´ ë“¤ì–´ ìˆì–´ìš”."
            },
            {
              id: "kimchi",
              name: "ë°°ì¶”ê¹€ì¹˜",
              calories: 20,
              price: 500,
              nutrients: ["ì±„ì†Œ"],
              note: "ë°œíš¨ ì‹í’ˆì´ë¼ ì¥ì—ë„ ì¢‹ì•„ìš”."
            },
            {
              id: "salad_side",
              name: "ìƒëŸ¬ë“œ í•œ ì»µ",
              calories: 40,
              price: 1000,
              nutrients: ["ì±„ì†Œ"],
              note: "ì—¬ëŸ¬ ì±„ì†Œê°€ ì„ì—¬ ìˆëŠ” ìƒëŸ¬ë“œì˜ˆìš”."
            }
          ]
        },
        {
          key: "fruit",
          title: "ê³¼ì¼ ë””ì €íŠ¸",
          subtitle: "ì‹ì‚¬ë¥¼ ë§ˆë¬´ë¦¬í•˜ëŠ” ìƒí¼í•œ ê³¼ì¼!",
          options: [
            {
              id: "orange",
              name: "ì˜¤ë Œì§€ í•œ ê°œ",
              calories: 60,
              price: 800,
              nutrients: ["ê³¼ì¼", "ë¹„íƒ€ë¯¼"],
              note: "ë¹„íƒ€ë¯¼ Cê°€ ë§ì•„ìš”."
            },
            {
              id: "banana",
              name: "ë°”ë‚˜ë‚˜ í•œ ê°œ",
              calories: 80,
              price: 800,
              nutrients: ["ê³¼ì¼"],
              note: "ë‹¬ì½¤í•´ì„œ ì—ë„ˆì§€ë¥¼ ì¤˜ìš”."
            },
            {
              id: "grapes",
              name: "í¬ë„ í•œ ì†¡ì´",
              calories: 70,
              price: 900,
              nutrients: ["ê³¼ì¼"],
              note: "ë‹¹ì´ ìˆì–´ ë„ˆë¬´ ë§ì´ ë¨¹ì§€ ì•Šë„ë¡ í•´ìš”."
            }
          ]
        }
      ]
    },
    salad: {
      groups: [
        {
          key: "base",
          title: "ìƒëŸ¬ë“œ ë² ì´ìŠ¤",
          subtitle: "ìƒëŸ¬ë“œì˜ ì–‘ì„ ì±„ì›Œì£¼ëŠ” ê¸°ë³¸ ì±„ì†Œì˜ˆìš”.",
          options: [
            {
              id: "mixed_greens",
              name: "í˜¼í•© ì±„ì†Œ(ìƒì¶”, ì¹˜ì»¤ë¦¬)",
              calories: 20,
              price: 800,
              nutrients: ["ì±„ì†Œ", "ì‹ì´ì„¬ìœ "],
              note: "ì—¬ëŸ¬ ì±„ì†Œê°€ ì„ì—¬ ìˆì–´ìš”."
            },
            {
              id: "romaine",
              name: "ë¡œë©”ì¸ ìƒì¶”",
              calories: 15,
              price: 700,
              nutrients: ["ì±„ì†Œ"],
              note: "ì•„ì‚­í•˜ê³  ì‹œì›í•œ ë§›ì´ì—ìš”."
            }
          ]
        },
        {
          key: "protein_salad",
          title: "ë‹¨ë°±ì§ˆ í† í•‘",
          subtitle: "ìƒëŸ¬ë“œì—ë„ ë‹¨ë°±ì§ˆì€ í•„ìš”í•´ìš”.",
          options: [
            {
              id: "boiled_egg",
              name: "ì‚¶ì€ ê³„ë€",
              calories: 80,
              price: 700,
              nutrients: ["ë‹¨ë°±ì§ˆ"],
              note: "ì†ì„ ë“ ë“ í•˜ê²Œ í•´ì¤˜ìš”."
            },
            {
              id: "tofu",
              name: "êµ¬ìš´ ë‘ë¶€",
              calories: 70,
              price: 800,
              nutrients: ["ë‹¨ë°±ì§ˆ"],
              note: "ì‹ë¬¼ì„± ë‹¨ë°±ì§ˆì´ì—ìš”."
            },
            {
              id: "yogurt",
              name: "í”Œë ˆì¸ ìš”ê±°íŠ¸",
              calories: 90,
              price: 900,
              nutrients: ["ë‹¨ë°±ì§ˆ", "ì¹¼ìŠ˜"],
              note: "ë“œë ˆì‹±ì²˜ëŸ¼ ê³ë“¤ì¼ ìˆ˜ë„ ìˆì–´ìš”."
            }
          ]
        },
        {
          key: "topping",
          title: "ê³¼ì¼Â·ì±„ì†Œ í† í•‘",
          subtitle: "ìƒ‰ê¹”ê³¼ ì˜ì–‘ì„ ë”í•´ìš”.",
          options: [
            {
              id: "tomato_cherry",
              name: "ë°©ìš¸í† ë§ˆí† ",
              calories: 15,
              price: 600,
              nutrients: ["ì±„ì†Œ", "ë¹„íƒ€ë¯¼"],
              note: "í•œ ì…ì— ì™ ë“¤ì–´ê°€ìš”."
            },
            {
              id: "cucumber",
              name: "ì˜¤ì´ ìŠ¬ë¼ì´ìŠ¤",
              calories: 10,
              price: 500,
              nutrients: ["ì±„ì†Œ"],
              note: "ì‹œì›í•˜ê³  ì•„ì‚­í•´ìš”."
            },
            {
              id: "apple_cube",
              name: "ì‚¬ê³¼ ì¡°ê°",
              calories: 30,
              price: 700,
              nutrients: ["ê³¼ì¼", "ë¹„íƒ€ë¯¼"],
              note: "ìƒëŸ¬ë“œì— ë‹¬ì½¤í•¨ì„ ë”í•´ìš”."
            }
          ]
        },
        {
          key: "dressing",
          title: "ë“œë ˆì‹±Â·ê¸°íƒ€",
          subtitle: "ìƒëŸ¬ë“œì˜ ë§›ì„ ê²°ì •í•˜ëŠ” ì†ŒìŠ¤ì˜ˆìš”.",
          options: [
            {
              id: "olive_dressing",
              name: "ì˜¬ë¦¬ë¸Œìœ +ë ˆëª¬ì¦™",
              calories: 80,
              price: 600,
              nutrients: ["ì§€ë°©"],
              note: "ë¹„êµì  ê±´ê°•í•œ ì§€ë°©ì´ì—ìš”."
            },
            {
              id: "cream_dressing",
              name: "í¬ë¦¼ ë“œë ˆì‹±",
              calories: 120,
              price: 700,
              nutrients: ["ì§€ë°©"],
              note: "ì¹¼ë¡œë¦¬ê°€ ì¡°ê¸ˆ ë†’ì•„ìš”."
            },
            {
              id: "no_dressing",
              name: "ë“œë ˆì‹± ì—†ì´ ë¨¹ê¸°",
              calories: 0,
              price: 0,
              nutrients: [],
              note: "ì¬ë£Œ ë³¸ì—°ì˜ ë§›ì„ ëŠê»´ìš”."
            }
          ]
        }
      ]
    }
  };

  // --------- ìƒíƒœ ê´€ë¦¬ ---------

  let currentMenuKey = null;
  let currentStoryIndex = 0;

  // --------- ìœ í‹¸ í•¨ìˆ˜ ---------
  function showScreen(id) {
    document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
  }

  function getSelectedIngredients() {
    const checked = document.querySelectorAll(".ingredient-option input:checked");
    const list = [];
    checked.forEach(input => {
      const info = JSON.parse(input.dataset.info);
      list.push(info);
    });
    return list;
  }

  function formatCurrency(num) {
    return num.toLocaleString("ko-KR") + "ì›";
  }

  function updateSelectionSummary() {
    const picked = getSelectedIngredients();
    const count = picked.length;
    const totalCal = picked.reduce((sum, item) => sum + item.calories, 0);
    const totalPrice = picked.reduce((sum, item) => sum + item.price, 0);
    const nutrientSet = new Set();
    picked.forEach(item => item.nutrients.forEach(n => nutrientSet.add(n)));
    const nutrientsText = nutrientSet.size ? Array.from(nutrientSet).join(", ") : "-";

    document.getElementById("sumCount").textContent = count + "ê°œ";
    document.getElementById("sumCalorie").textContent = totalCal + " kcal";
    document.getElementById("sumPrice").textContent = formatCurrency(totalPrice);
    document.getElementById("sumNutrients").textContent = nutrientsText;
  }

  // í‰ê°€ ë¡œì§
  function evaluateSelection() {
    if (!currentMenuKey) return { score: 0, feedback: "ë©”ë‰´ ì„ íƒ ì˜¤ë¥˜", badge: "" };

    const menu = MENUS[currentMenuKey];
    const picked = getSelectedIngredients();

    if (picked.length === 0) {
      return {
        score: 0,
        feedback: "ì•„ì§ ì¬ë£Œë¥¼ í•˜ë‚˜ë„ ê³ ë¥´ì§€ ì•Šì•˜ì–´ìš”.\nê° ì¹¸ì—ì„œ í•˜ë‚˜ì”© ê³¨ë¼ì£¼ì„¸ìš”.",
        badge: "ì¬ë£Œë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”."
      };
    }

    const totalCal = picked.reduce((sum, item) => sum + item.calories, 0);
    const totalPrice = picked.reduce((sum, item) => sum + item.price, 0);
    const nutrientSet = new Set();
    picked.forEach(item => item.nutrients.forEach(n => nutrientSet.add(n)));

    let score = 0;
    let lines = [];

    // 1. ì˜ì–‘ ê· í˜• ì ìˆ˜ (50ì )
    const nutrientCount = nutrientSet.size;
    if (nutrientCount >= 4) {
      score += 50;
      lines.push("âœ… ë‹¤ì–‘í•œ ì˜ì–‘ì†Œê°€ ê³¨ê³ ë£¨ ë“¤ì–´ê°€ ìˆì–´ìš”. (ì˜ì–‘ ì ìˆ˜ 50ì )");
    } else if (nutrientCount === 3) {
      score += 40;
      lines.push("âœ… ì˜ì–‘ì†Œê°€ ë¹„êµì  ê³¨ê³ ë£¨ ë“¤ì–´ê°€ ìˆì–´ìš”. (ì˜ì–‘ ì ìˆ˜ 40ì )");
    } else if (nutrientCount === 2) {
      score += 30;
      lines.push("âš  ì˜ì–‘ì†Œ ì¢…ë¥˜ê°€ ì¡°ê¸ˆ ë¶€ì¡±í•´ìš”. í•œ ê°€ì§€ë¥¼ ë” ì¶”ê°€í•´ ë³´ëŠ” ê±´ ì–´ë–¨ê¹Œìš”? (ì˜ì–‘ ì ìˆ˜ 30ì )");
    } else {
      score += 15;
      lines.push("âš  ê±°ì˜ í•œ ê°€ì§€ ì¢…ë¥˜ì˜ ì˜ì–‘ì†Œì—ë§Œ ì¹˜ìš°ì³ ìˆì–´ìš”. ë‹¤ë¥¸ ì¢…ë¥˜ ì¬ë£Œë„ ê³¨ë¼ë³´ì„¸ìš”. (ì˜ì–‘ ì ìˆ˜ 15ì )");
    }

    // 2. ì˜ˆì‚° ì ìˆ˜ (20ì )
    if (totalPrice <= menu.budget) {
      score += 20;
      lines.push(`âœ… ì˜ˆì‚°(${formatCurrency(menu.budget)}) ì•ˆì—ì„œ ì˜ ë§ì·„ì–´ìš”. (ì˜ˆì‚° ì ìˆ˜ 20ì )`);
    } else if (totalPrice <= menu.budget * 1.2) {
      score += 10;
      lines.push("âš  ì˜ˆì‚°ì„ ì¡°ê¸ˆ ë„˜ê²¼ì§€ë§Œ í¬ê²Œ ë²—ì–´ë‚˜ì§€ëŠ” ì•Šì•˜ì–´ìš”. (ì˜ˆì‚° ì ìˆ˜ 10ì )");
    } else {
      lines.push("âš  ì˜ˆì‚°ì„ ë§ì´ ë„˜ê²¼ì–´ìš”. ê°€ê²©ì´ ë‚®ì€ ì¬ë£Œë¡œ ë°”ê¿”ë³¼ê¹Œìš”? (ì˜ˆì‚° ì ìˆ˜ 0ì )");
    }

    // 3. ì¹¼ë¡œë¦¬ ì ìˆ˜ (20ì )
    if (totalCal >= menu.calorieMin && totalCal <= menu.calorieMax) {
      score += 20;
      lines.push(`âœ… ${menu.calorieMin}~${menu.calorieMax} kcal ë²”ìœ„ ì•ˆì— ìˆì–´ìš”. (ì¹¼ë¡œë¦¬ ì ìˆ˜ 20ì )`);
    } else if (
      (totalCal >= menu.calorieMin - 50 && totalCal < menu.calorieMin) ||
      (totalCal > menu.calorieMax && totalCal <= menu.calorieMax + 80)
    ) {
      score += 10;
      lines.push("âš  ì¹¼ë¡œë¦¬ê°€ ì•½ê°„ ë¶€ì¡±í•˜ê±°ë‚˜ ë§ì•„ìš”. ê·¸ë˜ë„ í¬ê²Œ ë²—ì–´ë‚˜ì§€ëŠ” ì•Šì•˜ì–´ìš”. (ì¹¼ë¡œë¦¬ ì ìˆ˜ 10ì )");
    } else if (totalCal === 0) {
      lines.push("âš  ì¹¼ë¡œë¦¬ê°€ 0ì´ì—ìš”. ì‚¬ì‹¤ìƒ ì•„ë¬´ê²ƒë„ ë¨¹ì§€ ì•ŠëŠ” ê²ƒê³¼ ë¹„ìŠ·í•´ìš”. (ì¹¼ë¡œë¦¬ ì ìˆ˜ 0ì )");
    } else {
      lines.push("âš  ì¹¼ë¡œë¦¬ê°€ ì ì ˆí•œ ë²”ìœ„ë¥¼ ë§ì´ ë²—ì–´ë‚¬ì–´ìš”. ì–‘ì„ ì¡°ì ˆí•´ ë³¼ê¹Œìš”? (ì¹¼ë¡œë¦¬ ì ìˆ˜ 0ì )");
    }

    // 4. ê±´ê°• ì ìˆ˜ (10ì ) â€“ ë„ˆë¬´ ê¸°ë¦„ì§„ ì„ íƒ/ê°€ê³µì‹í’ˆ ê°ì 
    let healthScore = 10;
    const hasHam = picked.some(item => item.id === "ham");
    const hasFried = picked.some(item => item.id === "fried_shrimp");
    const hasCreamDressing = picked.some(item => item.id === "cream_dressing");
    const mayoCount = picked.some(item => item.id === "mayo");

    let healthLines = [];
    if (hasHam) {
      healthScore -= 3;
      healthLines.push("Â· ê°€ê³µì‹í’ˆì¸ í–„ì„ ì‚¬ìš©í–ˆì–´ìš”. ë‚˜íŠ¸ë¥¨ì´ ë§ìœ¼ë‹ˆ ë„ˆë¬´ ìì£¼ ë¨¹ì§€ ì•Šë„ë¡ í•´ìš”.");
    }
    if (hasFried) {
      healthScore -= 3;
      healthLines.push("Â· íŠ€ê¹€(ìƒˆìš°íŠ€ê¹€)ì„ ì‚¬ìš©í–ˆì–´ìš”. ê¸°ë¦„ê¸°ê°€ ë§ìœ¼ë‹ˆ ì–‘ì„ ì¡°ì ˆí•´ìš”.");
    }
    if (hasCreamDressing) {
      healthScore -= 2;
      healthLines.push("Â· í¬ë¦¼ ë“œë ˆì‹±ì€ ì¹¼ë¡œë¦¬ê°€ ë†’ì•„ìš”. ë‹¤ë¥¸ ë“œë ˆì‹±ê³¼ ë²ˆê°ˆì•„ ë¨¹ìœ¼ë©´ ì¢‹ì•„ìš”.");
    }
    if (mayoCount) {
      healthScore -= 1;
      healthLines.push("Â· ë§ˆìš”ë„¤ì¦ˆë¥¼ ì‚¬ìš©í–ˆì–´ìš”. í•œ ìŠ¤í‘¼ ì •ë„ë§Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ì•„ìš”.");
    }
    if (healthScore < 0) healthScore = 0;
    score += healthScore;

    if (healthLines.length === 0) {
      lines.push("âœ… ë„ˆë¬´ ê¸°ë¦„ì§€ê±°ë‚˜ ê°€ê³µì‹í’ˆ ìœ„ì£¼ì˜ ì„ íƒì€ ì•„ë‹ˆì—ìš”. (ê±´ê°• ì ìˆ˜ 10ì )");
    } else {
      lines.push("âš  ë§›ì€ ì¢‹ì§€ë§Œ ê±´ê°•ì„ ì¡°ê¸ˆ ë” ìƒê°í•´ ë³¼ ìˆ˜ ìˆì–´ìš”. (ê±´ê°• ì ìˆ˜ " + healthScore + "ì )\n" +
                 healthLines.join("\n"));
    }

    // ë°°ì§€/í•œì¤„ í‰ê°€
    let badge = "";
    if (score >= 90) badge = "ì™„ë²½ì— ê°€ê¹Œìš´ ê· í˜• ì¡íŒ ì‹ë‹¨ì´ì—ìš”! ğŸ‘";
    else if (score >= 75) badge = "ê½¤ ì˜ êµ¬ì„±ëœ ì‹ë‹¨ì´ì—ìš”. ì•½ê°„ë§Œ ì¡°ì •í•˜ë©´ ë” ì¢‹ì•„ì§ˆ ìˆ˜ ìˆì–´ìš”.";
    else if (score >= 50) badge = "ê¸°ë³¸ì€ ì¡í˜€ ìˆì§€ë§Œ, ì˜ì–‘ì†Œ ì¢…ë¥˜ë‚˜ ì¹¼ë¡œë¦¬ë¥¼ ë‹¤ì‹œ ì‚´í´ë³´ë©´ ì¢‹ì•„ìš”.";
    else badge = "ì´ë²ˆ ê¸°íšŒì— ì‹í’ˆêµ°ê³¼ ì˜ì–‘ì†Œë¥¼ ë‹¤ì‹œ ê³µë¶€í•´ë³´ë©´ ë” ì¢‹ì€ ì„ íƒì„ í•  ìˆ˜ ìˆì„ ê±°ì˜ˆìš”!";

    return {
      score,
      feedback: lines.join("\n\n"),
      badge,
      totalCal,
      totalPrice,
      nutrients: Array.from(nutrientSet),
      picked
    };
  }

  // --------- ë Œë”ë§ ---------

  function renderMenuCards() {
    const grid = document.getElementById("menuGrid");
    grid.innerHTML = "";
    Object.values(MENUS).forEach(menu => {
      const card = document.createElement("div");
      card.className = "menu-card";
      card.dataset.key = menu.key;

      card.innerHTML = `
        <div class="menu-title">
          <span class="menu-emoji">${menu.emoji}</span>${menu.name}
        </div>
        <div class="menu-desc">${menu.desc}</div>
        <div class="menu-meta">
          ì˜ˆì‚° ì•½ ${formatCurrency(menu.budget)} Â· ê¶Œì¥ ì¹¼ë¡œë¦¬ ${menu.calorieMin}~${menu.calorieMax} kcal
        </div>
      `;
      card.addEventListener("click", () => {
        document.querySelectorAll(".menu-card").forEach(c => c.classList.remove("selected"));
        card.classList.add("selected");
        currentMenuKey = menu.key;
        document.getElementById("btnMenuNext").disabled = false;
      });
      grid.appendChild(card);
    });
  }

  function renderStory() {
    const menu = MENUS[currentMenuKey];
    const pages = STORY_PAGES[currentMenuKey] || [];
    const textEl = document.getElementById("storyText");
    const indexEl = document.getElementById("storyPageIndex");
    const badgeEl = document.getElementById("storyMenuBadge");

    badgeEl.textContent = `${menu.emoji} ${menu.name}`;
    textEl.textContent = pages[currentStoryIndex] || "";
    indexEl.textContent = `${currentStoryIndex + 1} / ${pages.length} ì¥`;

    const btnNext = document.getElementById("btnStoryNext");
    btnNext.textContent = currentStoryIndex === pages.length - 1
      ? "ì¬ë£Œ ê³ ë¥´ëŸ¬ ê°€ê¸° â–¶"
      : "ë‹¤ìŒ ì¥ ë„˜ê¸°ê¸° â–¶";
  }

  function renderBuilder() {
    const menu = MENUS[currentMenuKey];
    const config = INGREDIENTS[currentMenuKey];
    const grid = document.getElementById("builderGrid");
    grid.innerHTML = "";

    document.getElementById("builderSubTitle").textContent =
      `${menu.emoji} ${menu.name}ë¥¼(ì„) ë§Œë“¤ê¸° ìœ„í•´ ê° ì¹¸ì—ì„œ ì¬ë£Œë¥¼ í•˜ë‚˜ì”© ê³¨ë¼ë³´ì„¸ìš”.`;
    document.getElementById("pillBudget").textContent =
      `ì˜ˆì‚°: ì•½ ${formatCurrency(menu.budget)} ì´ë‚´`;
    document.getElementById("pillCalorie").textContent =
      `ê¶Œì¥ ì¹¼ë¡œë¦¬: ${menu.calorieMin}~${menu.calorieMax} kcal`;
    document.getElementById("pillGoal").textContent = `ëª©í‘œ: ${menu.goal}`;

    config.groups.forEach(group => {
      const box = document.createElement("div");
      box.className = "ingredient-group";
      box.innerHTML = `
        <div class="group-title">${group.title}</div>
        <div class="group-subtitle">${group.subtitle}</div>
      `;
      group.options.forEach(opt => {
        const option = document.createElement("label");
        option.className = "ingredient-option";

        const input = document.createElement("input");
        input.type = "radio";
        input.name = `group_${group.key}`;
        input.value = opt.id;
        input.dataset.info = JSON.stringify(opt);

        input.addEventListener("change", updateSelectionSummary);

        const info = document.createElement("div");
        info.innerHTML = `
          <div class="ingredient-main">${opt.name}</div>
          <div class="ingredient-meta">
            ${opt.calories} kcal Â· ${formatCurrency(opt.price)}
            ${opt.nutrients.length ? " Â· ì˜ì–‘ì†Œ: " + opt.nutrients.join(", ") : ""}
            <br>${opt.note}
          </div>
        `;

        option.appendChild(input);
        option.appendChild(info);
        box.appendChild(option);
      });

      grid.appendChild(box);
    });

    updateSelectionSummary();
  }

  function renderResult(result) {
    document.getElementById("resultScore").textContent = result.score;
    document.getElementById("resultBadge").textContent = result.badge;
    document.getElementById("feedbackText").textContent = result.feedback;

    const listEl = document.getElementById("resultSummaryList");
    listEl.innerHTML = "";

    const li1 = document.createElement("li");
    li1.textContent = `ì´ ì¹¼ë¡œë¦¬: ${result.totalCal} kcal`;
    const li2 = document.createElement("li");
    li2.textContent = `ì˜ˆìƒ ê°€ê²©: ${formatCurrency(result.totalPrice)}`;
    const li3 = document.createElement("li");
    li3.textContent = result.nutrients.length
      ? `í¬í•¨ëœ ì˜ì–‘ì†Œ: ${result.nutrients.join(", ")}`
      : "í¬í•¨ëœ ì˜ì–‘ì†Œ: -";
    const li4 = document.createElement("li");
    li4.textContent = "ì„ íƒí•œ ì¬ë£Œ: " + result.picked.map(p => p.name).join(", ");

    listEl.appendChild(li1);
    listEl.appendChild(li2);
    listEl.appendChild(li3);
    listEl.appendChild(li4);
  }

  // --------- ì´ë²¤íŠ¸ ë°”ì¸ë”© ---------

  document.addEventListener("DOMContentLoaded", () => {
    renderMenuCards();

    document.getElementById("btnMenuNext").addEventListener("click", () => {
      if (!currentMenuKey) return;
      currentStoryIndex = 0;
      renderStory();
      showScreen("screen-story");
    });

    document.getElementById("btnStoryBack").addEventListener("click", () => {
      showScreen("screen-menu");
    });

    document.getElementById("btnStoryNext").addEventListener("click", () => {
      const pages = STORY_PAGES[currentMenuKey] || [];
      if (currentStoryIndex < pages.length - 1) {
        currentStoryIndex += 1;
        renderStory();
      } else {
        // ìŠ¤í† ë¦¬ ë â†’ ì¬ë£Œ ì„ íƒ í™”ë©´
        renderBuilder();
        showScreen("screen-builder");
      }
    });

    document.getElementById("btnBuilderBack").addEventListener("click", () => {
      showScreen("screen-story");
    });

    document.getElementById("btnEvaluate").addEventListener("click", () => {
      const result = evaluateSelection();
      renderResult(result);
      showScreen("screen-result");
    });

    document.getElementById("btnResultBack").addEventListener("click", () => {
      showScreen("screen-builder");
    });

    document.getElementById("btnRestart").addEventListener("click", () => {
      // ì´ˆê¸°í™”
      currentMenuKey = null;
      currentStoryIndex = 0;
      renderMenuCards();
      document.getElementById("btnMenuNext").disabled = true;
      showScreen("screen-menu");
    });
  });
</script>
</body>
</html>
